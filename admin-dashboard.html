<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Dashboard ‚Ä¢ UniThrift</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  :root {
    --brand: #1e3a8a;
    --accent: #16a34a;
    --sand: #faf6ef;
    --ink: #111827;
    --muted: #6b7280;
  }
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    background: var(--sand);
    color: var(--ink);
  }
  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    width: 250px;
    background: white;
    border-right: 1px solid #e5e7eb;
    padding: 24px 0;
    overflow-y: auto;
  }
  .logo {
    padding: 0 24px 24px;
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--brand);
    border-bottom: 1px solid #e5e7eb;
  }
  .nav-section {
    padding: 16px 0;
  }
  .nav-title {
    padding: 8px 24px;
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .nav-item {
    padding: 12px 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    color: var(--ink);
    text-decoration: none;
    transition: all 0.2s;
    cursor: pointer;
  }
  .nav-item:hover {
    background: #f9fafb;
  }
  .nav-item.active {
    background: #eff6ff;
    color: var(--brand);
    border-left: 3px solid var(--brand);
    font-weight: 600;
  }
  .nav-icon {
    font-size: 1.25rem;
  }
  .main-content {
    margin-left: 250px;
    padding: 24px;
  }
  .header {
    background: white;
    padding: 24px;
    border-radius: 12px;
    margin-bottom: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 16px;
  }
  .header h1 {
    font-size: 1.75rem;
    margin-bottom: 4px;
  }
  .header-subtitle {
    color: var(--muted);
    font-size: 0.875rem;
  }
  .refresh-btn {
    padding: 10px 20px;
    background: var(--brand);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .refresh-btn:hover {
    background: #1e40af;
  }
  .filters {
    background: white;
    padding: 20px 24px;
    border-radius: 12px;
    margin-bottom: 24px;
  }
  .filters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-top: 16px;
  }
  .filter-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    font-size: 0.875rem;
  }
  .filter-group select,
  .filter-group input {
    width: 100%;
    padding: 10px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    font-size: 0.875rem;
  }
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
  }
  .stat-card {
    background: white;
    padding: 24px;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
  }
  .stat-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 16px;
  }
  .stat-title {
    font-size: 0.875rem;
    color: var(--muted);
    font-weight: 600;
  }
  .stat-icon {
    font-size: 1.5rem;
    opacity: 0.5;
  }
  .stat-value {
    font-size: 2rem;
    font-weight: 800;
    color: var(--brand);
    margin-bottom: 8px;
  }
  .stat-change {
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .stat-change.positive {
    color: #16a34a;
  }
  .stat-change.negative {
    color: #ef4444;
  }
  .charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
  }
  .chart-card {
    background: white;
    padding: 24px;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
  }
  .chart-card h3 {
    margin-bottom: 20px;
    font-size: 1.125rem;
  }
  .chart-container {
    position: relative;
    height: 300px;
  }
  .table-card {
    background: white;
    padding: 24px;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    overflow-x: auto;
  }
  .table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  .table-header h3 {
    font-size: 1.125rem;
  }
  .search-box {
    padding: 8px 12px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    font-size: 0.875rem;
    width: 250px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #f3f4f6;
  }
  th {
    font-weight: 600;
    color: var(--muted);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    user-select: none;
  }
  th:hover {
    color: var(--brand);
  }
  td {
    font-size: 0.875rem;
  }
  .status-badge {
    padding: 4px 8px;
    border-radius: 999px;
    font-size: 0.75rem;
    font-weight: 600;
  }
  .status-completed {
    background: #dcfce7;
    color: #166534;
  }
  .status-confirmed {
    background: #dbeafe;
    color: #1e40af;
  }
  .status-pending {
    background: #fef3c7;
    color: #92400e;
  }
  .loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px;
    color: var(--muted);
  }
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
  }
  .empty-icon {
    font-size: 3rem;
    margin-bottom: 16px;
    opacity: 0.5;
  }
  @media (max-width: 768px) {
    .sidebar {
      transform: translateX(-100%);
    }
    .main-content {
      margin-left: 0;
    }
    .charts-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
  <div class="sidebar">
    <div class="logo">UniThrift Admin</div>
    <nav>
      <div class="nav-section">
        <div class="nav-title">Main</div>
        <a class="nav-item active" onclick="showSection('dashboard')">
          <span class="nav-icon">üìä</span>
          <span>Dashboard</span>
        </a>
        <a class="nav-item" onclick="showSection('orders')">
          <span class="nav-icon">üì¶</span>
          <span>Orders</span>
        </a>
        <a class="nav-item" onclick="showSection('analytics')">
          <span class="nav-icon">üìà</span>
          <span>Analytics</span>
        </a>
      </div>
      <div class="nav-section">
        <div class="nav-title">Management</div>
        <a class="nav-item" onclick="showSection('products')">
          <span class="nav-icon">üè∑Ô∏è</span>
          <span>Products</span>
        </a>
        <a class="nav-item" onclick="showSection('users')">
          <span class="nav-icon">üë•</span>
          <span>Users</span>
        </a>
      </div>
      <div class="nav-section">
        <div class="nav-title">Settings</div>
        <a class="nav-item" href="index.html">
          <span class="nav-icon">üè†</span>
          <span>Back to Site</span>
        </a>
      </div>
    </nav>
  </div>

  <div class="main-content">
    <div class="header">
      <div>
        <h1>Dashboard Overview</h1>
        <div class="header-subtitle">Last updated: <span id="lastUpdated">‚Äî</span></div>
      </div>
      <button class="refresh-btn" onclick="refreshData()">
        <span>üîÑ</span>
        <span>Refresh Data</span>
      </button>
    </div>

    <div class="filters">
      <h3 style="margin-bottom: 12px;">Filters</h3>
      <div class="filters-grid">
        <div class="filter-group">
          <label>Date Range</label>
          <select id="dateRange" onchange="applyFilters()">
            <option value="7">Last 7 Days</option>
            <option value="30" selected>Last 30 Days</option>
            <option value="90">Last 90 Days</option>
            <option value="365">Last Year</option>
            <option value="all">All Time</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Campus</label>
          <select id="campusFilter" onchange="applyFilters()">
            <option value="all">All Campuses</option>
            <option value="ADMU">Ateneo (ADMU)</option>
            <option value="UPD">UP Diliman (UPD)</option>
            <option value="UST">UST</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Category</label>
          <select id="categoryFilter" onchange="applyFilters()">
            <option value="all">All Categories</option>
            <option value="Books">Books</option>
            <option value="School Supplies">School Supplies</option>
            <option value="Gadgets">Gadgets</option>
            <option value="Preloved">Preloved</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Status</label>
          <select id="statusFilter" onchange="applyFilters()">
            <option value="all">All Statuses</option>
            <option value="confirmed">Confirmed</option>
            <option value="preparing">Preparing</option>
            <option value="completed">Completed</option>
          </select>
        </div>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-title">Total Revenue</div>
          <div class="stat-icon">üí∞</div>
        </div>
        <div class="stat-value" id="totalRevenue">‚Ç±0</div>
        <div class="stat-change positive" id="revenueChange">
          <span>‚Üó</span> <span>0% from last period</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-title">Total Orders</div>
          <div class="stat-icon">üì¶</div>
        </div>
        <div class="stat-value" id="totalOrders">0</div>
        <div class="stat-change positive" id="ordersChange">
          <span>‚Üó</span> <span>0% from last period</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-title">Average Order Value</div>
          <div class="stat-icon">üìä</div>
        </div>
        <div class="stat-value" id="avgOrderValue">‚Ç±0</div>
        <div class="stat-change positive" id="avgChange">
          <span>‚Üó</span> <span>0% from last period</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-title">Active Users</div>
          <div class="stat-icon">üë•</div>
        </div>
        <div class="stat-value" id="activeUsers">0</div>
        <div class="stat-change positive" id="usersChange">
          <span>‚Üó</span> <span>0% from last period</span>
        </div>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-card">
        <h3>Revenue Trend</h3>
        <div class="chart-container">
          <canvas id="revenueChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <h3>Orders by Category</h3>
        <div class="chart-container">
          <canvas id="categoryChart"></canvas>
        </div>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-card">
        <h3>Sales by Campus</h3>
        <div class="chart-container">
          <canvas id="campusChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <h3>Payment Methods</h3>
        <div class="chart-container">
          <canvas id="paymentChart"></canvas>
        </div>
      </div>
    </div>

    <div class="table-card">
      <div class="table-header">
        <h3>Recent Orders</h3>
        <input type="text" class="search-box" id="searchBox" placeholder="Search orders..." onkeyup="searchOrders()">
      </div>
      <table id="ordersTable">
        <thead>
          <tr>
            <th onclick="sortTable('orderId')">Order ID</th>
            <th onclick="sortTable('date')">Date</th>
            <th onclick="sortTable('customer')">Customer</th>
            <th onclick="sortTable('items')">Items</th>
            <th onclick="sortTable('total')">Total</th>
            <th onclick="sortTable('payment')">Payment</th>
            <th onclick="sortTable('status')">Status</th>
          </tr>
        </thead>
        <tbody id="ordersTableBody">
          <tr>
            <td colspan="7" class="loading">Loading orders...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const API_BASE = "http://localhost:8000";
    let allOrders = [];
    let filteredOrders = [];
    let currentSort = { column: 'date', direction: 'desc' };
    let charts = {};

    // Generate mock data for demonstration
    function generateMockOrders() {
      const categories = ['Books', 'School Supplies', 'Gadgets', 'Preloved'];
      const campuses = ['ADMU', 'UPD', 'UST'];
      const statuses = ['confirmed', 'preparing', 'completed'];
      const payments = ['gcash', 'card', 'cash'];
      
      const orders = [];
      const now = Date.now();
      
      for (let i = 0; i < 50; i++) {
        const daysAgo = Math.floor(Math.random() * 90);
        const orderDate = new Date(now - daysAgo * 24 * 60 * 60 * 1000);
        const category = categories[Math.floor(Math.random() * categories.length)];
        const campus = campuses[Math.floor(Math.random() * campuses.length)];
        const itemCount = Math.floor(Math.random() * 5) + 1;
        const subtotal = Math.floor(Math.random() * 500) + 100;
        
        orders.push({
          orderId: `ORD-${1000 + i}`,
          date: orderDate.toISOString(),
          customer: `user${i}@example.com`,
          items: itemCount,
          category: category,
          campus: campus,
          subtotal: subtotal,
          deliveryFee: 50,
          total: subtotal + 50,
          paymentMethod: payments[Math.floor(Math.random() * payments.length)],
          status: statuses[Math.floor(Math.random() * statuses.length)],
          phone: `+63 9XX XXX ${String(i).padStart(4, '0')}`
        });
      }
      
      return orders;
    }

    async function fetchOrders() {
      try {
        // Try to fetch from API
        const response = await fetch(`${API_BASE}/api/orders`);
        if (response.ok) {
          return await response.json();
        }
      } catch (error) {
        console.log('API not available, using local data');
      }
      
      // Fallback to localStorage or mock data
      const localOrders = JSON.parse(localStorage.getItem('orders') || '[]');
      if (localOrders.length > 0) {
        return localOrders;
      }
      
      // Generate and save mock data
      const mockOrders = generateMockOrders();
      localStorage.setItem('orders', JSON.stringify(mockOrders));
      return mockOrders;
    }

    function formatPeso(n) {
      return "‚Ç±" + Number(n).toLocaleString("en-PH", { maximumFractionDigits: 0 });
    }

    function formatDate(isoString) {
      return new Date(isoString).toLocaleDateString('en-PH', {
        month: 'short',
        day: 'numeric',
        year: 'numeric'
      });
    }

    function applyFilters() {
      const dateRange = parseInt(document.getElementById('dateRange').value);
      const campus = document.getElementById('campusFilter').value;
      const category = document.getElementById('categoryFilter').value;
      const status = document.getElementById('statusFilter').value;

      const now = Date.now();
      const cutoffDate = dateRange === 'all' ? 0 : now - dateRange * 24 * 60 * 60 * 1000;

      filteredOrders = allOrders.filter(order => {
        const orderDate = new Date(order.date).getTime();
        const dateMatch = dateRange === 'all' || orderDate >= cutoffDate;
        const campusMatch = campus === 'all' || order.campus === campus;
        const categoryMatch = category === 'all' || order.category === category;
        const statusMatch = status === 'all' || order.status === status;
        
        return dateMatch && campusMatch && categoryMatch && statusMatch;
      });

      updateDashboard();
    }

    function updateDashboard() {
      updateStats();
      updateCharts();
      renderOrdersTable();
    }

    function updateStats() {
      const totalRevenue = filteredOrders.reduce((sum, o) => sum + o.total, 0);
      const totalOrders = filteredOrders.length;
      const avgOrderValue = totalOrders > 0 ? totalRevenue / totalOrders : 0;
      const activeUsers = new Set(filteredOrders.map(o => o.customer)).size;

      document.getElementById('totalRevenue').textContent = formatPeso(totalRevenue);
      document.getElementById('totalOrders').textContent = totalOrders;
      document.getElementById('avgOrderValue').textContent = formatPeso(avgOrderValue);
      document.getElementById('activeUsers').textContent = activeUsers;

      // Calculate changes (mock percentage for demo)
      const revenueChange = Math.floor(Math.random() * 30) + 5;
      const ordersChange = Math.floor(Math.random() * 20) + 3;
      
      document.getElementById('revenueChange').innerHTML = `<span>‚Üó</span> <span>${revenueChange}% from last period</span>`;
      document.getElementById('ordersChange').innerHTML = `<span>‚Üó</span> <span>${ordersChange}% from last period</span>`;
      document.getElementById('avgChange').innerHTML = `<span>‚Üó</span> <span>8% from last period</span>`;
      document.getElementById('usersChange').innerHTML = `<span>‚Üó</span> <span>12% from last period</span>`;
    }

    function updateCharts() {
      updateRevenueChart();
      updateCategoryChart();
      updateCampusChart();
      updatePaymentChart();
    }

    function updateRevenueChart() {
      const ctx = document.getElementById('revenueChart').getContext('2d');
      
      // Group by date
      const revenueByDate = {};
      filteredOrders.forEach(order => {
        const date = formatDate(order.date);
        revenueByDate[date] = (revenueByDate[date] || 0) + order.total;
      });

      const dates = Object.keys(revenueByDate).sort();
      const revenues = dates.map(date => revenueByDate[date]);

      if (charts.revenue) charts.revenue.destroy();
      
      charts.revenue = new Chart(ctx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [{
            label: 'Revenue',
            data: revenues,
            borderColor: '#1e3a8a',
            backgroundColor: 'rgba(30, 58, 138, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: value => '‚Ç±' + value
              }
            }
          }
        }
      });
    }

    function updateCategoryChart() {
      const ctx = document.getElementById('categoryChart').getContext('2d');
      
      const categoryData = {};
      filteredOrders.forEach(order => {
        categoryData[order.category] = (categoryData[order.category] || 0) + 1;
      });

      if (charts.category) charts.category.destroy();
      
      charts.category = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: Object.keys(categoryData),
          datasets: [{
            data: Object.values(categoryData),
            backgroundColor: ['#1e3a8a', '#3b82f6', '#60a5fa', '#93c5fd']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    function updateCampusChart() {
      const ctx = document.getElementById('campusChart').getContext('2d');
      
      const campusData = {};
      filteredOrders.forEach(order => {
        campusData[order.campus] = (campusData[order.campus] || 0) + order.total;
      });

      if (charts.campus) charts.campus.destroy();
      
      charts.campus = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Object.keys(campusData),
          datasets: [{
            label: 'Revenue by Campus',
            data: Object.values(campusData),
            backgroundColor: '#16a34a'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: value => '‚Ç±' + value
              }
            }
          }
        }
      });
    }

    function updatePaymentChart() {
      const ctx = document.getElementById('paymentChart').getContext('2d');
      
      const paymentData = {};
      filteredOrders.forEach(order => {
        const method = order.paymentMethod || 'cash';
        paymentData[method] = (paymentData[method] || 0) + 1;
      });

      if (charts.payment) charts.payment.destroy();
      
      charts.payment = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: Object.keys(paymentData).map(k => k.toUpperCase()),
          datasets: [{
            data: Object.values(paymentData),
            backgroundColor: ['#fbbf24', '#1e3a8a', '#16a34a']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    function renderOrdersTable() {
      const tbody = document.getElementById('ordersTableBody');
      const searchTerm = document.getElementById('searchBox').value.toLowerCase();
      
      let displayOrders = filteredOrders;
      if (searchTerm) {
        displayOrders = filteredOrders.filter(order => 
          order.orderId.toLowerCase().includes(searchTerm) ||
          order.customer.toLowerCase().includes(searchTerm)
        );
      }

      // Apply sorting
      displayOrders.sort((a, b) => {
        let aVal = a[currentSort.column];
        let bVal = b[currentSort.column];
        
        if (currentSort.column === 'date') {
          aVal = new Date(aVal).getTime();
          bVal = new Date(bVal).getTime();
        } else if (typeof aVal === 'string') {
          aVal = aVal.toLowerCase();
          bVal = bVal.toLowerCase();
        }
        
        if (currentSort.direction === 'asc') {
          return aVal > bVal ? 1 : -1;
        } else {
          return aVal < bVal ? 1 : -1;
        }
      });

      if (displayOrders.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="empty-state"><div class="empty-icon">üì¶</div><div>No orders found</div></td></tr>';
        return;
      }

      tbody.innerHTML = displayOrders.slice(0, 20).map(order => `
        <tr>
          <td><strong>${order.orderId}</strong></td>
          <td>${formatDate(order.date)}</td>
          <td>${order.customer}</td>
          <td>${order.items} item${order.items > 1 ? 's' : ''}</td>
          <td><strong>${formatPeso(order.total)}</strong></td>
          <td>${(order.paymentMethod || 'cash').toUpperCase()}</td>
          <td><span class="status-badge status-${order.status}">${order.status.toUpperCase()}</span></td>
        </tr>
      `).join('');
    }

    function sortTable(column) {
      if (currentSort.column === column) {
        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
      } else {
        currentSort.column = column;
        currentSort.direction = 'asc';
      }
      renderOrdersTable();
    }

    function searchOrders() {
      renderOrdersTable();
    }

    async function refreshData() {
      document.getElementById('lastUpdated').textContent = 'Refreshing...';
      allOrders = await fetchOrders();
      applyFilters();
      document.getElementById('lastUpdated').textContent = new Date().toLocaleString('en-PH');
    }

    function showSection(section) {
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      event.target.classList.add('active');
      // In a real app, you'd show/hide different sections here
      alert(`Navigation to ${section} section (not implemented in demo)`);
    }

    // Initialize
    window.addEventListener('DOMContentLoaded', async () => {
      await refreshData();
    });
  </script>
</body>
</html>