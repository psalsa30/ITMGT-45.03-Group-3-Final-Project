<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>UniThrift ‚Ä¢ Listings</title>
<link rel="stylesheet" href="styles.css" />
<style>
  .grid { 
    display:grid; 
    grid-template-columns: repeat(auto-fill,minmax(200px,1fr)); 
    gap:16px; 
    padding:16px; 
  }
  .card { 
    background:#fff; 
    border:1px solid #eee; 
    border-radius:12px; 
    padding:12px; 
    display:flex; 
    flex-direction:column; 
    gap:8px;
    position: relative;
  }
  .card img { 
    width:100%; 
    height:140px; 
    object-fit:cover; 
    border-radius:8px; 
  }
  .price { font-weight:800; }
  .toolbar { 
    display:flex; 
    gap:8px; 
    align-items:center; 
    padding:12px 16px; 
    flex-wrap: wrap;
  }
  .badge { 
    position:relative; 
    top:-1px; 
    margin-left:4px; 
    font-size:12px; 
    background:#16a34a; 
    color:#fff; 
    padding:2px 6px; 
    border-radius:999px; 
  }
  .wishlist-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: white;
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.25rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    z-index: 1;
    transition: transform 0.2s;
  }
  .wishlist-btn:hover {
    transform: scale(1.1);
  }
  .wishlist-btn.active {
    color: #ef4444;
  }
  .plus-badge-small {
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 700;
    margin-left: 4px;
  }
  .early-access-banner {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    padding: 12px 16px;
    border-radius: 8px;
    margin: 8px 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 12px;
  }
  .early-access-banner strong {
    color: #92400e;
  }
  .early-access-banner a {
    background: #92400e;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 600;
    font-size: 0.875rem;
  }
</style>
</head>
<body>
  <header style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#fff;border-bottom:1px solid #eee">
    <a href="index.html" style="font-weight:800;text-decoration:none;color:#1e3a8a">UniThrift</a>
    <nav>
      <a href="index.html">Home</a>
      <a href="wishlist.html">Wishlist</a>
      <a href="unithrift-plus.html">Plus</a>
      <a href="cart.html">Cart <span id="cartBadge" class="badge" style="display:none">0</span></a>
    </nav>
  </header>

  <div id="earlyAccessBanner"></div>

  <div class="toolbar">
    <strong id="title">All Items</strong>
    <span id="activeFilters" style="color:#6b7280"></span>
  </div>

  <main class="grid" id="grid"></main>

  <script>
    // demo data
    const products = [
      { id:"b-101", name:"GE Book: Ethics", price:120, campus:"ADMU", category:"Books", image:"https://picsum.photos/seed/book/400/300", earlyAccess: true },
      { id:"s-201", name:"A4 Bond Paper (500s)", price:180, campus:"ADMU", category:"School Supplies", image:"https://picsum.photos/seed/paper/400/300" },
      { id:"g-301", name:"Wired Earphones", price:150, campus:"UPD", category:"Gadgets", image:"https://picsum.photos/seed/ear/400/300" },
      { id:"p-401", name:"Preloved Hoodie", price:130, campus:"ADMU", category:"Preloved", image:"https://picsum.photos/seed/hood/400/300" },
      { id:"b-102", name:"Calculus Textbook", price:200, campus:"UST", category:"Books", image:"https://picsum.photos/seed/calc/400/300", earlyAccess: true },
      { id:"g-302", name:"USB-C Cable", price:85, campus:"ADMU", category:"Gadgets", image:"https://picsum.photos/seed/usb/400/300" },
    ];

    const params = new URLSearchParams(location.search);
    const campus = params.get("campus");
    const category = params.get("category");
    const priceMin = Number(params.get("priceMin")) || 0;
    const priceMax = Number(params.get("priceMax")) || Infinity;

    function formatPeso(n){ return `‚Ç±${n.toFixed(0)}` }

    function isPlusSubscriber() {
      const subscription = JSON.parse(localStorage.getItem('unithriftPlus') || 'null');
      if (!subscription) return false;
      const expiryDate = new Date(subscription.expiryDate);
      return expiryDate > new Date();
    }

    function getWishlist() {
      try {
        return JSON.parse(localStorage.getItem('wishlist') || '[]');
      } catch {
        return [];
      }
    }

    function toggleWishlist(productId) {
      let wishlist = getWishlist();
      if (wishlist.includes(productId)) {
        wishlist = wishlist.filter(id => id !== productId);
      } else {
        wishlist.push(productId);
      }
      localStorage.setItem('wishlist', JSON.stringify(wishlist));
      renderGrid(filterProducts(products));
    }

    function filterProducts(list){
      const isPlus = isPlusSubscriber();
      let filtered = list.filter(p =>
        (!campus || p.campus === campus) &&
        (!category || p.category === category) &&
        (p.price >= priceMin && p.price <= priceMax)
      );

      // Filter early access items for non-Plus users
      if (!isPlus) {
        filtered = filtered.filter(p => !p.earlyAccess);
      }

      return filtered;
    }

    function renderGrid(list){
      const el = document.getElementById("grid");
      const wishlist = getWishlist();
      const isPlus = isPlusSubscriber();

      // Show early access banner for non-Plus users
      const banner = document.getElementById("earlyAccessBanner");
      const hasEarlyAccessItems = products.some(p => p.earlyAccess);
      if (!isPlus && hasEarlyAccessItems) {
        banner.innerHTML = `
          <div class="early-access-banner">
            <div>
              <strong>‚≠ê Unlock Early Access!</strong> 
              <span style="color: #6b7280;">Some items are available 24 hours early for UniThrift Plus members.</span>
            </div>
            <a href="unithrift-plus.html">Upgrade to Plus</a>
          </div>
        `;
      } else {
        banner.innerHTML = '';
      }

      el.innerHTML = "";
      list.forEach(p => {
        const isWishlisted = wishlist.includes(p.id);
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <button class="wishlist-btn ${isWishlisted ? 'active' : ''}" onclick="toggleWishlist('${p.id}')">
            ${isWishlisted ? '‚ù§Ô∏è' : 'ü§ç'}
          </button>
          <img src="${p.image}" alt="${p.name}"/>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="font-weight:700">${p.name}</div>
              <div class="price">${formatPeso(p.price)}</div>
              <div style="color:#6b7280;font-size:12px">
                ${p.campus} ‚Ä¢ ${p.category}
                ${p.earlyAccess && isPlus ? '<span class="plus-badge-small">EARLY</span>' : ''}
              </div>
            </div>
            <button data-id="${p.id}" class="addBtn">Add</button>
          </div>
        `;
        el.appendChild(card);
      });
      document.querySelectorAll(".addBtn").forEach(btn=>{
        btn.addEventListener("click", () => addToCart(btn.getAttribute("data-id")));
      });
    }

    function updateHeader(){
      const t = document.getElementById("title");
      const f = document.getElementById("activeFilters");
      const parts = [];
      if (campus) parts.push(campus);
      if (category) parts.push(category);
      if (isFinite(priceMax) || priceMin>0) parts.push(`‚Ç±${priceMin||0}‚Äì${isFinite(priceMax)?priceMax:"‚àû"}`);
      t.textContent = parts.length ? parts.join(" ¬∑ ") : "All Items";
      f.textContent = params.toString() ? `Filters: ${params.toString()}` : "";
    }

    function addToCart(productId){
      const item = products.find(p => p.id === productId);
      if(!item) return;
      const raw = localStorage.getItem("cart") || "[]";
      const cart = JSON.parse(raw);
      const idx = cart.findIndex(i => i.productId === productId);
      if (idx >= 0) cart[idx].quantity += 1;
      else cart.push({ productId, name:item.name, price:item.price, quantity:1, image:item.image });
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartBadge();
      
      // Show feedback
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = '‚úì Added';
      btn.style.background = '#16a34a';
      btn.style.color = 'white';
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = '';
        btn.style.color = '';
      }, 1000);
    }

    function updateCartBadge(){
      const badge = document.getElementById("cartBadge");
      try {
        const cart = JSON.parse(localStorage.getItem("cart") || "[]");
        const qty = cart.reduce((n,i)=>n+(i.quantity||1),0);
        if(qty>0){ badge.textContent = qty; badge.style.display = "inline-block"; }
        else { badge.style.display = "none"; }
      } catch { badge.style.display = "none"; }
    }

    updateHeader();
    renderGrid(filterProducts(products));
    updateCartBadge();
  </script>
</body>
</html>